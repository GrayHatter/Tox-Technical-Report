\documentclass{tox}

\begin{document}

\title{A secure, distributed multimedia messenger}

\abstract{\
  \textbf{Abstract}:
Tox is a secure, lightweight, distributed messenger platform designed to 
provide maximum security without penalizing performance.
}

\author{Written by irungentoo} %add your name here when you contribute to it.

\maketitle

\section{Introduction}

When one first starts a Tox client, a long term asymmetric keypair is created. 
This keypair identifies the user uniquely. If a Tox user wants to connect to 
another user, he needs to obtain their long term public key. 

\subsection{Crypto}

Tox uses crypto\_box() from the NaCl crypto library for all the cryptography in 
Tox. Unless otherwise noted, all keys refer to keys generated with 
crypto\_box\_keypair(), all encryption is done with crypto\_box() and all 
decryption with crypto\_box\_open(). For performance purposes the functions to 
precomputed the shared secret and encrypt and decrypt messages with it are used 
extensively in Tox however this is not relevant to this document.

crypto\_box() provides fast public-key authenticated encryption. For exactly 
how it works read the NaCl docs.

\subsection{Tox ID}

What is referred to as the Tox ID is in fact the long term public key of that 
Tox user with a nospam value and a checksum appended to it. The exact format is:

[NaCl crypto\_box() public key (32 bytes)][nospam (4 bytes)][checksum (2 bytes)]

The Tox ID is 38 bytes and usually distributed in hex format. A typical valid 
Tox ID looks like:

56A1ADE4B65B86BCD51CC73E2CD4E542179F47959FE3E0E21B4B0ACDADE51855D34D34D37CB5

The nospam value is there to permit users from quickly changing their Tox ids 
without changing identities. How it works is explained later in the friend 
request section.

The checksum is a checksum to prevent users from adding mistyped or badly 
copied Tox IDs. It is a simple XOR checksum. Code to compute the checksum from 
a partial ID of ID\_length follows.

\begin{lstlisting}
uint8_t checksum[2] = {0};
uint32_t i;

for (i = 0; i < ID_length; ++i)
    checksum[i % 2] ^= ID[i];

\end{lstlisting}

\subsection{Friends}

To add another Tox user as a friend, the user must first obtain their Tox ID. 
The Tox ID can be transmitted across insecure channels or posted publicly. The 
user must make sure however that the Tox ID he adds belongs to his friend and 
not an impersonator.

Each Tox instance contains a friends list. This is a list of added friends 
which the user has added to his client. Tox will try to connect to everyone in 
the friends list. In order to connect to a friend, the friend must have the 
user in their friends list or else the connection will fail. Friends who the 
user is connected to are shown as online, friends who are not connected are 
shown as offline.

Users who are not in the friends list of a certain user can not connect to him.

There are two ways to add an entry to the friends list. The first is to add the 
Tox ID of a Tox user and the second is to accept a friend request.

\subsection{Friend Requests}

When a Tox user adds a Tox ID, Tox sends a friend request to the Tox user 
corresponding to the added ID. A friend requests contains the long term public 
key of the user making the request, the nospam contained in the Tox ID and a 
custom user specified message.

When a Tox user receives a friend request, he checks if the nospam is valid (if 
it matches the one he used to generate a Tox id). If it isn't valid, the friend 
request is discarded. If it is valid, the friend request is presented to the 
user along with the message specified in it.

The user can then accept the request and add the other user to his friends list 
or he can refuse it and simply discard the friend request.


\end{document}
